<div class="card-body" id="affichage_qr">
    <h6 class="card-title"></h6>
    <div class="col-md-9 qrludo-QR rounded" id="qrView">
      <!-- ici le QrCode a afficher -->
        <div>

        </div>
    </div>
</div>
<div class="card-footer" id="affichage_qr_footer">
  <form>
  <button type="button" class="btn btn-outline-success" id="listenField" disabled>
    <i class="fa fa-play"></i>&nbsp;&nbsp;Lire
  </button>
  <button type="button" class="btn btn-outline-success" id="stopSpeech">
    <i class="fa fa-pause"></i>&nbsp;&nbsp;Stop
  </button>
  <button type="button" class="btn btn-outline-success float-lg-right" id="saveQRCode" disabled>
    <i class="fa fa-download"></i>&nbsp;&nbsp;Exporter
  </button>
</form>
</div>

<script src="./index.js"></script>
<script>

  $("#listenField").on("click", function(){
    console.log("click");
    for (data of $('.qrData')) {
      if(data.name == 'legendeQR'){
        var utter = new SpeechSynthesisUtterance();
        utter.text = data.value;
        utter.onend = function(event) { console.log('Speech complete'); }
        console.log(speechSynthesis.getVoices());
        utter.voice = speechSynthesis.getVoices()[26];
        speechSynthesis.speak(utter);
      }
      else if(data.name == 'AudioName'){
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        var context = new AudioContext();
        var request = new XMLHttpRequest();
        var source = context.createBufferSource(); // creates a sound source

        request.open('GET', 'https://drive.google.com/uc?export=download&id=' + data.id, true);
        request.responseType = 'arraybuffer';

        // Decode asynchronously
        request.onload = function() {
          context.decodeAudioData(request.response, function(buffer) {

            source.buffer = buffer;                    // tell the source which sound to play
            source.connect(context.destination);       // connect the source to the context's destination (the speakers)
            source.start(0);
          }, function(error){
            console.log(error);
          });
        }
        request.send();

    }
  }
  });

  $("#stopSpeech").on("click", function(){
    if(speechSynthesis.speaking){
      speechSynthesis.pause();
    }
    else if(speechSynthesis.paused){
      speechSynthesis.resume();
    }
  });


</script>
